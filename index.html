<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stand By Me - Bottle Stand Game</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f5f5f5;
        user-select: none;
    }
    h1 {
        margin-top: 10px;
    }
    #game-area {
        width: 320px;
        height: 520px;
        background: white;
        border: 3px solid #ccc;
        margin: 0 auto;
        margin-top: 20px;
        position: relative;
        overflow: hidden;
        border-radius: 10px;
    }

    /* Rope & Ring */
    #rope {
        width: 4px;
        height: 200px;
        background: black;
        position: absolute;
        top: 0;
        left: 158px;
        transform-origin: top;
    }
    #ring {
        width: 45px;
        height: 45px;
        border: 5px solid red;
        border-radius: 50%;
        position: absolute;
        top: 180px;
        left: 135px;
        pointer-events: none;
        transform-origin: center;
    }

    /* Bottle */
    #bottle {
        width: 45px;
        height: 90px;
        background: linear-gradient(#4caf50, #2d7b2f);
        position: absolute;
        bottom: 20px;
        left: 137px;
        border-radius: 10px 10px 5px 5px;
        transition: transform 1s ease;
    }

    #message {
        font-size: 20px;
        font-weight: bold;
        margin-top: 15px;
        color: green;
        height: 30px;
    }

    #restart-btn {
        margin-top: 15px;
        padding: 10px 20px;
        border: none;
        background: #2196f3;
        color: white;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
    }
</style>
</head>
<body>

<h1>Stand By Me</h1>
<p>Inspired by Taiwan night market ‚Äústand the bottle‚Äù game</p>

<div id="game-area">
    <div id="rope"></div>
    <div id="ring"></div>
    <div id="bottle"></div>
</div>

<div id="message"></div>
<button id="restart-btn">Restart</button>

<script>
/* Basic physics + drag controls */
const rope = document.getElementById("rope");
const ring = document.getElementById("ring");
const bottle = document.getElementById("bottle");
const msg = document.getElementById("message");

let dragging = false;
let ropeX = 158;
let angle = 0;
let velocity = 0;
let hooked = false;

/* Drag rope horizontally */
document.getElementById("game-area").addEventListener("mousedown", () => dragging = true);
document.addEventListener("mouseup", () => dragging = false);
document.addEventListener("mousemove", (e) => {
    if (!dragging) return;

    let rect = game-area.getBoundingClientRect();
    ropeX = e.clientX - rect.left;

    if (ropeX < 20) ropeX = 20;
    if (ropeX > 300) ropeX = 300;
});

/* Mobile dragging */
document.getElementById("game-area").addEventListener("touchmove", (e)=>{
    let t = e.touches[0];
    let rect = game-area.getBoundingClientRect();
    ropeX = t.clientX - rect.left;
    if (ropeX < 20) ropeX = 20;
    if (ropeX > 300) ropeX = 300;
});

/* Main animation loop */
function animate() {
    // Rope sway physics
    velocity += (ropeX - (rope.offsetLeft + 2)) * 0.01;
    velocity *= 0.95;
    angle += velocity;

    rope.style.left = ropeX + "px";
    rope.style.transform = `rotate(${angle}deg)`;

    let ringX = ropeX - 23 + Math.sin(angle * Math.PI/180) * 40;
    let ringY = 180 + Math.cos(angle * Math.PI/180) * 10;

    ring.style.left = ringX + "px";
    ring.style.top = ringY + "px";

    // Bottle position
    const bottleRect = bottle.getBoundingClientRect();
    const ringRect = ring.getBoundingClientRect();

    // Collision detection for hooking
    if (!hooked &&
        ringRect.bottom > bottleRect.top + 20 &&
        ringRect.left < bottleRect.right &&
        ringRect.right > bottleRect.left
    ) {
        hooked = true;
        msg.textContent = "You hooked it! Pull up!";
    }

    // Bottle stands when hooked and rope moves up
    if (hooked) {
        bottle.style.transform = "rotate(0deg)";
        const newBottom = parseFloat(bottle.style.bottom) + 0.4;
        bottle.style.bottom = newBottom + "px";

        if (newBottom > 120) {
            msg.textContent = "üéâ You made it stand! Great job!";
        }
    }

    requestAnimationFrame(animate);
}
animate();

/* Restart button */
document.getElementById("restart-btn").addEventListener("click", () => {
    ropeX = 158;
    angle = 0;
    velocity = 0;
    hooked = false;
    bottle.style.bottom = "20px";
    msg.textContent = "";
});
</script>

</body>
</html>
